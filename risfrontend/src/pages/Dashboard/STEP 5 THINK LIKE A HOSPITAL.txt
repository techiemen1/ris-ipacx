ğŸ§‘â€âš•ï¸ STEP 5 â€” THINK LIKE A HOSPITAL

Ask these before writing code:

What happens if PACS is down?

What if patient ID duplicates?

What if report is edited after sign?

What if doctor logs in from mobile?

What if audit is requested by regulator?

Phase 0 â€” Planning (1â€“2 days)

Final module list

Database schema

Role matrix

API contracts

Phase 1 â€” Skeleton

Empty backend

Empty frontend

Login only

Health check endpoint

Phase 2 â€” Core Clinical Flow

Patient â†’ Order â†’ Study â†’ Report

1ï¸âƒ£ â€œDesign database firstâ€
2ï¸âƒ£ â€œDesign modules & API contractsâ€
3ï¸âƒ£ â€œDesign hospital workflow (clinical flow)â€
4ï¸âƒ£ â€œDesign deployment & DevOpsâ€

0ï¸âƒ£ First: Your Vision Is Correct
Web-first
Viewer-agnostic
Modular
Role-driven
Zero hard dependency on a single PACS
1ï¸âƒ£ ACCESS MODEL (LAN / WAN / Cloud / Internet)
| Access Type                  | How                     |
| ---------------------------- | ----------------------- |
| LAN (Hospital)               | Direct access           |
| WAN (Branch / Teleradiology) | VPN or Zero-Trust       |
| Cloud                        | Reverse proxy + TLS     |
| Internet                     | Only via secure gateway |
Architecture
User
 â†“
HTTPS (TLS)
 â†“
Reverse Proxy (Nginx / Traefik)
 â†“
Auth Gateway (SSO / JWT)
 â†“
RIS + Viewer + APIs

2ï¸âƒ£ DEVICE & BROWSER SUPPORT 
| Use Case               | Recommendation          |
| ---------------------- | ----------------------- |
| Desktop (Radiologists) | Chrome / Edge / Firefox |
| Tablets                | Chrome / Safari         |
| Mobile                 | Web (read-only / lite)  |
| Diagnostic reading     | Desktop only (Weasis)   |
Mobile is for:
Review
Clinical rounds
Emergency lookups
Radiologists â†’ Desktop viewers only (compliance).
3ï¸âƒ£ UI / UX MODEL (Tabs like Chrome)
Recommended UI Layout
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ iPACX RIS | Dashboard | PACS | Reports | â€¦ â”‚  â† module tabs
â”‚                                            â”‚
â”‚                               User âŒ„       â”‚  â† profile menu
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚               Active Module                 â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Top-right user dropdown
Profile
Preferences
Notifications
Role switch (if allowed)
Admin settings (admins only)
Logout
âš ï¸ Never mix admin tools into main workflow tabs

4ï¸âƒ£ MODULE-BY-MODULE PROFESSIONAL DESIGN
4.1ï¸âƒ£ Dashboard (Live, Aggregated)
Purpose
Single glass view of system health + workflow.
Should show:
Todayâ€™s studies
Pending reports
Critical findings
PACS connectivity status
Modality activity
Failed DICOM sends
Billing pending items
User activity alerts
Data Source
RIS DB
PACS REST
Background jobs
âš ï¸ Dashboard is read-only, fast, cached.
4.2ï¸âƒ£ Appointments (Scheduling Engine)
Your idea is correct, but add constraints.
Required Features
Create / reschedule / cancel
Modality-aware slots
Radiologist availability
Equipment downtime
Status lifecycle:
Scheduled â†’ Arrived â†’ Scanned â†’ Reported â†’ Billed
Advanced (Phase 2)
SMS / WhatsApp reminders
No-show tracking
Walk-in handling
4.3ï¸âƒ£ PACS Module (Very Important)
PACS Worklist (Web)
Pagination (server-side) 20 / 50 / 100 per page
Filters: Date (today, yesterday, range) Modality Patient ID / Name Accession Status Sorting
Lazy loading (critical for performance)
Study Row Actions
View Images (viewer)
Open Report (split mode)
Reassign radiologist
Flag critical
Audit history
Viewer + Report (Split Mode)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Viewer      â”‚   Report      â”‚
â”‚               â”‚               â”‚
â”‚               â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
4.4ï¸âƒ£ Modality Worklist (MWL Server)
You must include this early.
Features
DICOM MWL SCP
RIS â†’ PACS â†’ Modality
Scheduled Procedure Steps
Modality filtering
4.5ï¸âƒ£ Billing Module
Keep it decoupled.
Core
CPT / LOINC mapping
Procedure pricing
Insurance logic
Invoice generation
Payment status
4.6ï¸âƒ£ Inventory
Often ignored â€” but important.
Consumables (contrast, film)
Equipment maintenance
AMC schedules
Alerts
4.7ï¸âƒ£ Settings (User vs Admin)
     Normal User
Profile
Signature
Preferences
Viewer defaults
Notifications
      Admin (Strict RBAC)
User & role management
PACS registry (Orthanc, dcm4chee)
DICOM AE management
HL7 / FHIR scripts
Backup & restore
Audit logs
System health
Security policies
Login session rules
âš ï¸ Admin UI must be physically separated.
5ï¸âƒ£ SECURITY & COMPLIANCE (NON-NEGOTIABLE)
Mandatory
HTTPS everywhere
JWT + refresh tokens
RBAC
Audit logs
IP restrictions
Login time tracking
Failed login alerts
Session expiry
Healthcare Reality
If you design this now, certification later is easy.
6ï¸âƒ£ WHAT YOU DID NOT MENTION (BUT MUST ADD)
These are professional must-haves:
ğŸ”¹ Audit & Legal
Who viewed what study
Who edited report
Timestamped logs
ğŸ”¹ Downtime Mode
PACS down
Viewer cached
Read-only fallback
ğŸ”¹ Multi-PACS Support
Orthanc now
dcm4chee later
Vendor-neutral registry
ğŸ”¹ AI Integration (Future)
AI result overlays
Secondary capture
Structured findings
7ï¸âƒ£ TECHNOLOGY RECOMMENDATION (Safe Choices)
Layer	Tech
Frontend	React + TypeScript
Backend	Node.js (Nest later)
DB	PostgreSQL
PACS	Orthanc / dcm4chee
Viewer	OHIF + Weasis
Auth	JWT + optional SSO
Infra	Docker + Portainer
Proxy	Nginx / Traefik

ğŸ—ï¸ REPORT MODULE â€” PROFESSIONAL ARCHITECTURE
1ï¸âƒ£ REPORT WORKFLOW (INDUSTRY STANDARD)

This must be enforced, not optional.

Draft
  â†“
Preliminary
  â†“
Final
  â†“
Addendum (if needed)

Status Rules
Status	Who can edit
Draft	Radiologist
Preliminary	Radiologist
Final	Locked
Addendum	Append only

âš ï¸ Final reports must NEVER be editable
Only addendums allowed.
ğŸ—ï¸ REPORT MODULE â€” PROFESSIONAL ARCHITECTURE
1ï¸âƒ£ REPORT WORKFLOW (INDUSTRY STANDARD)

This must be enforced, not optional.

Draft
  â†“
Preliminary
  â†“
Final
  â†“
Addendum (if needed)

Status Rules
Status	Who can edit
Draft	Radiologist
Preliminary	Radiologist
Final	Locked
Addendum	Append only

âš ï¸ Final reports must NEVER be editable
Only addendums allowed.
2ï¸âƒ£ REPORT TYPES (YOU NEED ALL)
| Type           | Purpose             |
| -------------- | ------------------- |
| Free-text      | Complex cases       |
| Template-based | Speed + consistency |
| Structured     | AI & analytics      |
| Hybrid         | Real-world default  |
Most hospitals use hybrid.
3ï¸âƒ£ TEMPLATE ENGINE (VERY IMPORTANT)
Template Dimensions
Templates are NOT just by modality.
They must be configurable by:
Modality
Body part
Clinical indication
Protocol
Radiologist preference
Template Example
{
  "modality": "CT",
  "bodyPart": "Chest",
  "sections": [
    "Clinical History",
    "Technique",
    "Findings",
    "Impression"
  ]
}
Smart Behaviors
Auto-fill Technique from DICOM tags
Auto-insert measurements
Auto-suggest impression phrases
4ï¸âƒ£ VOICE DICTATION (MANDATORY)
Minimum (Phase 1)
Browser-based voice â†’ text
Manual correction
Hotkeys
Professional (Phase 2)
Medical vocabulary
Punctuation handling
Section-aware dictation
Offline fallback (desktop)
Enterprise (Phase 3)
Dragon / Google / Azure integration
Speaker profiles
Noise suppression
âš ï¸ Never hardcode one voice provider

5ï¸âƒ£ AI-ASSISTED REPORTING (DESIGN NOW, ENABLE LATER)
You mentioned:
AI based reports
Deep learning based reports
Correct â€” but do NOT let AI auto-finalize reports.
Correct AI Roles
âœ” Suggest findings
âœ” Suggest impressions
âœ” Flag abnormalities
âœ” Populate structured fields
âœ” Compare prior studies
Architecture Pattern
Image â†’ AI Engine â†’ Suggestions â†’ Radiologist Approval
6ï¸âƒ£ KEY IMAGES (VERY IMPORTANT)
What are Key Images?
Annotated slices
Representative findings
Legal evidence
System Requirements
Capture from viewer
Store reference (SOP UID + frame)
Embed reference into report
Exportable (PDF, HL7, DICOM SR)
7ï¸âƒ£ ULTRASOUND & DOPPLER MEASUREMENTS (SPECIAL CASE)
You are absolutely right to call this out.
Requirements
Length, area, volume
Doppler velocities
Ratios (RI, PI)
Auto-calculated values
Integration Model
Viewer sends measurements â†’ RIS
Report auto-populates values
Locked once final
âš ï¸ Measurements must be traceable to image.
8ï¸âƒ£ REPORT EDITOR UI (INDUSTRY STANDARD)
Recommended Layout
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Viewer (images, tools, measurements)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Report Editor                         â”‚
â”‚  - Sections                           â”‚
â”‚  - Templates                          â”‚
â”‚  - Voice input                        â”‚
â”‚  - AI suggestions (side panel)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Mandatory Features
Section locking
Phrase library
Macros
Undo history
Auto-save
Compare previous reports
9ï¸âƒ£ REPORT SIGNING & LEGAL COMPLIANCE
Required
Digital signature
Time-stamped
User-bound
Immutable after final
Addendum Rules
Linked to original report
Date + reason mandatory
Non-destructive
ğŸ” 10ï¸âƒ£ AUDIT & TRACEABILITY (LEGAL REQUIREMENT)

Every report action must be logged:
| Action                 | Logged |
| ---------------------- | ------ |
| Create                 | âœ…      |
| Edit                   | âœ…      |
| Voice input            | âœ…      |
| AI suggestion accepted | âœ…      |
| Finalized              | âœ…      |
| Addendum               | âœ…      |
11ï¸âƒ£ REPORT OUTPUT FORMATS

You must support:

âœ” PDF
âœ” HL7 ORU
âœ” FHIR DiagnosticReport
âœ” DICOM SR (future)
Design once â€” reuse forever.
12ï¸âƒ£ WHAT MOST SYSTEMS MISS (ADD THESE)
These are high-value features:
Critical findings alerts
Peer review mode
Teaching file tagging
Research anonymization
Multi-language reports
Custom report branding per site
CORRECT ARCHITECTURAL DEPENDENCY TREE
Module Boundaries & APIs   â† MUST COME FIRST
        â†“
Report Workflow & States  â† MUST COME SECOND
        â†“
RBAC Matrix
        â†“
UI Wireframes
        â†“
Templates & Structured Reporting
        â†“
Voice + AI Integration
Iâ€™ll define clear module boundaries and API contracts the way large healthcare vendors do it, so you can build confidently without rewrites.

ğŸ—ï¸ STEP A â€” MODULE BOUNDARIES (AUTHORITATIVE)
Core Principle (Lock This)

Each module owns its data, logic, and lifecycle
Other modules interact only via APIs, never by direct DB access.

This is non-negotiable for scalability, compliance, and future integrations.
SYSTEM MODULE MAP (High Level)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚  (Tabs, UX, Viewer Launch)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 API GATEWAY                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“        â†“        â†“        â†“
   RIS Core  Reporting  Viewer   Admin
              Module   Orchestr.
       â†“        â†“        â†“
     PACS Abstraction Layer
       â†“
   Orthanc / dcm4chee / Others
1ï¸âƒ£ RIS CORE MODULE (The Brain)
Responsibility
Owns workflow, not images.
Owns
Patients
Orders / studies
Appointments
Status lifecycle
Worklists

Does NOT
Render images
Store DICOM
Generate reports
RIS Core APIs (Contract)
GET    /api/ris/patients
POST   /api/ris/patients
GET    /api/ris/studies
POST   /api/ris/studies
PATCH  /api/ris/studies/{id}/status
GET    /api/ris/worklist
Example: Study Object (Canonical)
2ï¸âƒ£ PACS ABSTRACTION MODULE (Critical)
Responsibility
Vendor-neutral access to PACS.

Owns
PACS registry
DICOMweb endpoints
REST mappings
Health checks

Does NOT
Store images
Decide workflows
PACS Registry API
GET    /api/pacs
POST   /api/pacs
PUT    /api/pacs/{id}
DELETE /api/pacs/{id}
GET    /api/pacs/{id}/health
Example PACS Record
{
  "id": "orthanc-primary",
  "type": "ORTHANC",
  "baseUrl": "http://192.168.1.34:8042",
  "dicomWeb": "/dicom-web",
  "aet": "IPACXPACS"
}
ğŸ”‘ This allows Orthanc today, dcm4chee tomorrow without code changes.

3ï¸âƒ£ VIEWER ORCHESTRATION MODULE (Very Important)
Responsibility
Decides how a study is viewed.

Owns
Viewer registry
Viewer URLs
Launch rules

Does NOT
Render viewer UI
Access PACS directly
Viewer APIs
GET /api/viewer/launch?studyId=...

Response
{
  "url": "https://viewer.ipacx.local/viewer?StudyInstanceUIDs=1.2.840..."
}
Viewer Registry Example
{
  "viewerId": "ipacx-ohif",
  "type": "OHIF",
  "launchMode": "WEB",
  "supports": ["CT", "MR", "XR"]
}
RIS never hardcodes viewers.
This is how white-labeling stays clean.
4ï¸âƒ£ REPORTING MODULE (Isolated & Sacred)
Responsibility
Everything related to reports.

Owns
Report lifecycle
Templates
Versions
Signatures
AI suggestions
Key images

Does NOT
Change study status directly
Talk to PACS directly
Reporting APIs
POST   /api/reports
GET    /api/reports/{studyId}
PUT    /api/reports/{id}
POST   /api/reports/{id}/finalize
POST   /api/reports/{id}/addendum
Report State (Immutable)
{
  "status": "DRAFT | PRELIM | FINAL | ADDENDUM"
}.
ğŸ”’ Final reports are immutable by design
5ï¸âƒ£ ADMIN MODULE (Strictly Separated)
Responsibility
System control & governance.

Owns
Users
Roles
Permissions
PACS config
Backups
System health
Audit logs

Does NOT
Touch clinical workflow
Edit reports
Admin APIs
POST   /api/admin/users
GET    /api/admin/roles
POST   /api/admin/roles
GET    /api/admin/audit
POST   /api/admin/backup
POST   /api/admin/restore
6ï¸âƒ£ INTEGRATION MODULE (HL7 / FHIR / AI)
Responsibility
All external systems.

Owns
HL7 listeners
FHIR endpoints
AI engines
Webhooks

Does NOT
Store clinical truth
Override user decisions
Example
POST /api/integration/hl7/orm
POST /api/integration/ai/analyze
ğŸ” GLOBAL RULES (LOCK THESE)

âŒ No module accesses another moduleâ€™s DB
âœ… All interaction via APIs
âŒ No PACS logic in RIS
âœ… Viewer is replaceable
âœ… Reporting is immutable after final
âœ… Admin is isolated
These rules make your system:
Certifiable
Scalable
Vendor-neutral
AI-ready

ğŸ STEP A COMPLETE
You now have:
Clear module ownership
Clean API contracts
Zero tight coupling
Enterprise-grade foundation

ğŸ§  REPORT WORKFLOW & STATE MACHINE (AUTHORITATIVE)
Core Principle (NON-NEGOTIABLE)

A report is a legal medical document.
Once finalized, it must be immutable.
Corrections are handled via addendums, never edits.

This is the foundation of radiology law worldwide
1ï¸âƒ£ REPORT STATE MACHINE (CANONICAL)
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  DRAFT    â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  PRELIMINARY   â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     FINAL      â”‚  ğŸ”’ LOCKED
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ADDENDUM     â”‚  â• APPEND ONLY
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
2ï¸âƒ£ STATE DEFINITIONS (VERY PRECISE)
ğŸŸ¡ DRAFT
Purpose: Working space for the radiologist.

Characteristics
Editable
Auto-saved
Voice dictation allowed
AI suggestions allowed
Templates editable
Measurements auto-populate

Who can access
Assigned radiologist
Supervising radiologist (optional)
API
POST /api/reports
PUT  /api/reports/{id}
ğŸŸ  PRELIMINARY

Purpose: Urgent communication before final sign-off.
Characteristics
Visible to clinicians
Marked clearly as Preliminary
Editable by radiologist
Cannot be auto-finalized
Critical findings can be triggered
Who can access
Radiologists
Clinicians (read-only)
Legal Note
Preliminary reports must be traceable.
API
POST /api/reports/{id}/preliminary
ğŸ”µ FINAL (LOCKED)

Purpose: Legal diagnostic report.
Characteristics
Digitally signed
Timestamped
Immutable
Distributed (HL7 / PDF / FHIR)
Stored permanently
AI disabled at this stage
Who can access
Everyone (read-only)
Only signing radiologist is listed
Hard Rule

âŒ NO EDITS ALLOWED
âŒ NO DELETIONS

API
POST /api/reports/{id}/finalize
ğŸŸ£ ADDENDUM (APPEND-ONLY)

Purpose: Correction or clarification after final.

Characteristics
Linked to original report
Cannot modify original content
Requires reason
Signed separately
Timestamped
Example
â€œAddendum: Upon further reviewâ€¦â€

API
POST /api/reports/{id}/addendum
3ï¸âƒ£ REPORT VERSIONING MODEL (LEGAL SAFETY)
Why versioning matters

Audit
Disputes
Accreditation
Version Rules
| State       | Versioning     |
| ----------- | -------------- |
| Draft       | Incremental    |
| Preliminary | Snapshotted    |
| Final       | Version frozen |
| Addendum    | New version    |
Storage Model
report_versions (
  report_id,
  version,
  state,
  content,
  created_by,
  created_at
)
Nothing is ever deleted.
4ï¸âƒ£ ROLE-BASED PERMISSIONS (TIED TO STATES)
| Role               | Draft | Prelim | Final | Addendum |
| ------------------ | ----- | ------ | ----- | -------- |
| Radiologist        | âœï¸    | âœï¸     | ğŸ”’    | â•        |
| Senior Radiologist | ğŸ‘€    | âœï¸     | ğŸ”’    | â•        |
| Clinician          | ğŸ‘€    | ğŸ‘€     | ğŸ‘€    | ğŸ‘€       |
| Admin              | âŒ     | âŒ      | âŒ     | âŒ        |
âš ï¸ Admins NEVER edit reports

5ï¸âƒ£ AI & VOICE RULES (VERY IMPORTANT)
AI Allowed ONLY In:
Draft
Preliminary
AI Forbidden In:
Final
Addendum
AI Interaction Model
AI Suggestion â†’ Radiologist Accepts â†’ Becomes Text
AI suggestions are logged.
6ï¸âƒ£ KEY IMAGES & MEASUREMENTS (STATE-AWARE)
Draft / Preliminary
Can add/remove key images
Can edit measurements
Final
Key images locked
Measurements locked
Addendum
New key images allowed
Old ones untouched

Each key image stores:
SOP Instance UID
Frame
Annotation metadata
7ï¸âƒ£ CRITICAL FINDINGS WORKFLOW

This is industry standard.
Trigger conditions
Radiologist flags finding as critical
System actions
Immediate alert (SMS / app / email)
Timestamp logged
Acknowledgement tracked
Critical flags are preserved forever.
8ï¸âƒ£ ERROR & EDGE CASE HANDLING
Radiologist unavailable mid-report
Draft auto-saved
Another radiologist can resume (if allowed)
Report sent prematurely
Must be finalized or addendum added
Never overwritten

9ï¸âƒ£ WHAT WE JUST LOCKED ğŸ”’
You now have:

âœ” Legally defensible workflow
âœ” Immutable reporting
âœ” AI-safe design
âœ” Audit-ready structure
âœ” Multi-hospital compliant logic

This is enterprise-grade.
1ï¸âƒ£ Report Editor UI Wireframe (foundation)
2ï¸âƒ£ Template & Structured Reporting Model (built on UI)
3ï¸âƒ£ Voice + AI Integration Strategy (plugs into both)
PART 1ï¸âƒ£ â€” REPORT EDITOR UI WIREFRAME (INDUSTRY STANDARD)
ğŸ¯ Design Goal

Maximize radiologist speed, focus, and legal safety.
ğŸ§± CANONICAL REPORTING SCREEN LAYOUT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Study Info | Status | Timer | Critical Flag | Finalize     â”‚  â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Viewer (OHIF / Weasis embedded or side-by-side)           â”‚
â”‚                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Report Editor Tabs                                         â”‚
â”‚  â”œ Clinical History                                       â”‚
â”‚  â”œ Technique                                               â”‚
â”‚  â”œ Findings                                                â”‚
â”‚  â”œ Impression                                              â”‚
â”‚  â”œ Addendum (if any)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Active Section Editor                                     â”‚
â”‚  - Rich text                                               â”‚
â”‚  - Structured fields                                       â”‚
â”‚  - Voice dictation                                         â”‚
â”‚                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Templates | Macros | AI Suggestions | Measurements | Save  â”‚  â† Footer
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ”‘ UI RULES (VERY IMPORTANT)
| State       | UI Behavior               |
| ----------- | ------------------------- |
| Draft       | Fully editable            |
| Preliminary | Editable + warning banner |
| Final       | Read-only                 |
| Addendum    | Append-only editor        |
Buttons change based on state, not role alone.
ğŸ§  Radiologist Productivity Features

âœ” Auto-save every few seconds
âœ” Keyboard shortcuts
âœ” Phrase library (macros)
âœ” Section jump hotkeys
âœ” Report compare (prior study)
âš ï¸ Finalize UX (Critical)

Finalization must require:
Confirmation dialog
Password / biometric
Legal disclaimer
This prevents accidental final reports.
PART 2ï¸âƒ£ â€” TEMPLATE & STRUCTURED REPORTING MODEL

Now that the UI is clear, we define how content is structured.

ğŸ§© TEMPLATE TYPES (ALL REQUIRED)
1. Free Text
Unlimited
Used for rare cases

2. Section Templates
Findings boilerplates
Impression patterns

3. Structured Templates
Dropdowns
Checkboxes
Measurements

4. Hybrid (Default)
Structured + editable narrative

ğŸ“ TEMPLATE HIERARCHY (IMPORTANT)
Global Templates
  â””â”€â”€ Modality Templates
        â””â”€â”€ Body Part Templates
              â””â”€â”€ Protocol Templates
Radiologists can override without breaking structure.
ğŸ—‚ï¸ TEMPLATE DATA MODEL
{
  "templateId": "ct-chest-v1",
  "modality": "CT",
  "sections": [
    {
      "name": "Findings",
      "type": "structured",
      "fields": [
        {
          "label": "Lung Nodules",
          "type": "checkbox"
        }
      ]
    }
  ]
}
ğŸ§  Smart Behaviors

Auto-fill Technique from DICOM
Auto-insert measurements
Auto-suggest Impression text
Prior comparison awareness
ğŸ” Template Governance

Admin creates base templates
Radiologists can personalize
Hospital-level locking supported

PART 3ï¸âƒ£ â€” VOICE + AI INTEGRATION STRATEGY

Now we plug intelligence into the already-safe workflow.

ğŸ¤ VOICE DICTATION (PHASED)
Phase 1 (Now)
Browser speech API
Section-aware dictation
Manual correction

Phase 2
Medical vocabulary
Offline desktop (Weasis plugin)

Phase 3
Dragon / Azure / Google
Speaker profiles
âœ” Provider-agnostic
âœ” No hard dependency
ğŸ¤– AI ASSISTANCE (STRICTLY AUGMENTATIVE)
AI CAN:

Suggest findings
Suggest impressions
Compare prior reports
Flag inconsistencies

AI CANNOT:
Finalize reports
Modify signed content
Operate silently
ğŸ§  AI Interaction Model
Image â†’ AI Engine
       â†“
 Structured Suggestions
       â†“
 Radiologist Accepts / Rejects
       â†“
 Becomes Report Content
 âš–ï¸ MEDICO-LEGAL SAFEGUARDS

âœ” Human-in-the-loop
âœ” Audit trails
âœ” Explicit acceptance
âœ” Version tracking

This protects:
Radiologist
Hospital
You (vendor)

Below is a healthcare-grade, state-aware Security & RBAC matrix, designed exactly the way enterprise RIS/PACS vendors do it.

This will now become a locked architectural artifact ğŸ”’.

ğŸ” SECURITY & RBAC MATRIX (ENTERPRISE-GRADE)
Core Security Principles (NON-NEGOTIABLE)
Least privilege â€“ users see only what they must
State-aware permissions â€“ rights depend on workflow state
Role â‰  User â€“ users can hold multiple roles
Admin â‰  Clinician â€“ absolute separation
Audit everything â€“ no silent actions
1ï¸âƒ£ USER ROLES (CANONICAL SET)
These roles cover 95% of hospitals worldwide.
Clinical Roles
Radiologist
Senior Radiologist / Supervisor
Referring Clinician
Technologist
Operational Roles
Reception / Scheduler
Billing Officer
Inventory Manager
System Roles
System Admin
IT / PACS Admin
Audit / Compliance Officer
âš ï¸ A user may have multiple roles, but UI & permissions are resolved dynamically.
2ï¸âƒ£ MODULE-LEVEL ACCESS MATRIX
| Module        | Radiologist | Clinician | Tech | Billing | Admin |
| ------------- | ----------- | --------- | ---- | ------- | ----- |
| Dashboard     | R           | R         | R    | R       | R     |
| Appointments  | R           | R         | RW   | R       | RW    |
| PACS Worklist | R           | R         | R    | âŒ       | R     |
| Viewer        | RW          | R         | R    | âŒ       | R     |
| Reporting     | RW          | R         | âŒ    | âŒ       | âŒ     |
| MWL           | âŒ           | âŒ         | RW   | âŒ       | R     |
| Billing       | âŒ           | âŒ         | âŒ    | RW      | R     |
| Inventory     | âŒ           | âŒ         | âŒ    | âŒ       | RW    |
| Admin         | âŒ           | âŒ         | âŒ    | âŒ       | RW    |
Legend:

R = Read
RW = Read / Write
âŒ = No access
3ï¸âƒ£ REPORTING â€” STATE-AWARE RBAC (VERY IMPORTANT)

This is where most systems fail.
Your system will not.

ğŸ“„ REPORT STATE PERMISSIONS
| Role               | Draft   | Preliminary | Final   | Addendum |
| ------------------ | ------- | ----------- | ------- | -------- |
| Radiologist        | âœï¸ Edit | âœï¸ Edit     | ğŸ”’ Read | â• Add    |
| Senior Radiologist | ğŸ‘€ Read | âœï¸ Edit     | ğŸ”’ Read | â• Add    |
| Clinician          | ğŸ‘€ Read | ğŸ‘€ Read     | ğŸ‘€ Read | ğŸ‘€ Read  |
| Technologist       | âŒ       | âŒ           | âŒ       | âŒ        |
| Admin              | âŒ       | âŒ           | âŒ       | âŒ        |
Hard Rules
âŒ Admins cannot edit reports
âŒ Final reports cannot be modified
âœ… Addendums are append-only
âœ… All transitions are logged
4ï¸âƒ£ ACTION-LEVEL PERMISSIONS (FINE-GRAINED)
Report Actions
| Action               | Allowed Roles       |
| -------------------- | ------------------- |
| Create report        | Radiologist         |
| Edit draft           | Radiologist         |
| Move to preliminary  | Radiologist         |
| Finalize             | Radiologist         |
| Add addendum         | Radiologist, Senior |
| Delete report        | âŒ Nobody            |
| Accept AI suggestion | Radiologist         |
| Reject AI suggestion | Radiologist         |
5ï¸âƒ£ VIEWER & PACS SECURITY
Viewer Actions
| Action            | Radiologist | Clinician | Tech |
| ----------------- | ----------- | --------- | ---- |
| View images       | âœ…           | âœ…         | âœ…    |
| Annotate          | âœ…           | âŒ         | âŒ    |
| Capture key image | âœ…           | âŒ         | âŒ    |
| Measurements      | âœ…           | âŒ         | âŒ    |
PACS Admin Actions
| Action            | PACS Admin |
| ----------------- | ---------- |
| Add PACS          | âœ…          |
| Remove PACS       | âœ…          |
| Change AE titles  | âœ…          |
| Test connectivity | âœ…          |
6ï¸âƒ£ ADMIN & SYSTEM SECURITY (ISOLATED)
Admin Capabilities (Strict)
User creation / deactivation
Role assignment
PACS configuration
HL7 / FHIR integration
Backup / restore
System health monitoring
Security policy enforcement
Explicitly Forbidden for Admin
Editing reports
Viewing patient images without audit
Modifying clinical workflow states

7ï¸âƒ£ AUTHENTICATION & SESSION RULES
Authentication
Username + password (baseline)
Optional MFA (recommended)
Optional SSO (OIDC / SAML)
Session Controls
Idle timeout
Max concurrent sessions
IP / geo restriction
Login time windows (optional)

8ï¸âƒ£ AUDIT & COMPLIANCE (MANDATORY)
Audited Events
Login / logout
Report create / edit / finalize
Viewer access
PACS access
AI suggestion usage
Admin changes
Failed logins
Audit Log Rules
Immutable
Time-stamped
User-bound
Exportable
This satisfies:
NABH / JCI
HIPAA principles
GDPR principles
9ï¸âƒ£ DATA ACCESS CONTROL (PATIENT SAFETY)
Patient access is role-scoped
Cross-department access logged
Emergency override (â€œbreak-glassâ€) logged
Pediatric / VIP patient flags supported

2ï¸âƒ£ Database schema for reports + templates
hospital-grade, legally safe, AI-ready database schema that:
Supports all reporting workflows
Enforces immutability
Supports templates, AI, voice, key images
Scales to multi-hospital / multi-PACS
Avoids future migrations pain
This is exactly how enterprise RIS vendors design it.

ğŸ—„ï¸ REPORTING DATABASE SCHEMA (AUTHORITATIVE)
Design Principles (LOCKED)
Reports are immutable after FINAL
Versions are never deleted
Templates are reusable & hierarchical
AI & voice are metadata, not truth
Key images are references, not copies
1ï¸âƒ£ CORE TABLES (MUST HAVE)
ğŸ§¾ reports â€” The Legal Record
This table represents the current state of a report.
CREATE TABLE reports (
  id UUID PRIMARY KEY,
  study_id UUID NOT NULL,
  current_state VARCHAR(20) NOT NULL, -- DRAFT | PRELIM | FINAL | ADDENDUM
  current_version INT NOT NULL,
  signed_by UUID,
  signed_at TIMESTAMP,
  created_by UUID NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),

  CONSTRAINT fk_reports_study FOREIGN KEY (study_id) REFERENCES studies(id)
);
Notes
signed_by and signed_at are only populated on FINAL
current_state drives RBAC & UI
current_version points to report_versions
ğŸ“œ report_versions â€” Immutable History
This is the most important table legally.
CREATE TABLE report_versions (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  version INT NOT NULL,
  state VARCHAR(20) NOT NULL,
  content JSONB NOT NULL,
  created_by UUID NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),

  CONSTRAINT fk_versions_report FOREIGN KEY (report_id) REFERENCES reports(id),
  UNIQUE (report_id, version)
);
Why JSONB?
Supports free text
Supports structured fields
Supports AI annotations
Future-proof

âŒ Never update a row here
âœ… Always insert a new version
2ï¸âƒ£ TEMPLATE SYSTEM (CRITICAL)
ğŸ“‘ report_templates
CREATE TABLE report_templates (
  id UUID PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  modality VARCHAR(20),
  body_part VARCHAR(50),
  protocol VARCHAR(100),
  scope VARCHAR(20) NOT NULL, -- GLOBAL | HOSPITAL | USER
  owner_id UUID,
  template JSONB NOT NULL,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP NOT NULL DEFAULT NOW()
);
Template JSON Example
{
  "sections": [
    {
      "name": "Findings",
      "type": "structured",
      "fields": [
        { "label": "Lung Nodules", "type": "checkbox" }
      ]
    }
  ]
}
ğŸ§© report_macros (Phrase Library)
CREATE TABLE report_macros (
  id UUID PRIMARY KEY,
  trigger VARCHAR(50) NOT NULL,
  content TEXT NOT NULL,
  owner_id UUID,
  scope VARCHAR(20), -- USER | HOSPITAL
  created_at TIMESTAMP DEFAULT NOW()
);
3ï¸âƒ£ KEY IMAGES & MEASUREMENTS
ğŸ–¼ï¸ report_key_images
CREATE TABLE report_key_images (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  sop_instance_uid TEXT NOT NULL,
  frame_number INT,
  annotation JSONB,
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT fk_key_images_report FOREIGN KEY (report_id) REFERENCES reports(id)
);
Key images are references, not stored files.
ğŸ“ report_measurements
CREATE TABLE report_measurements (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  name VARCHAR(100),
  value NUMERIC,
  unit VARCHAR(20),
  source VARCHAR(50), -- US | CT | MR
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT fk_measurements_report FOREIGN KEY (report_id) REFERENCES reports(id)
);
Supports:
Ultrasound
Doppler
CT / MR measurements
4ï¸âƒ£ AI & VOICE (TRACKED, NOT AUTHORITATIVE)
ğŸ¤– report_ai_suggestions
CREATE TABLE report_ai_suggestions (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  suggestion JSONB NOT NULL,
  accepted BOOLEAN,
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT fk_ai_report FOREIGN KEY (report_id) REFERENCES reports(id)
);
Every AI suggestion is logged.
ğŸ¤ report_voice_sessions
CREATE TABLE report_voice_sessions (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  provider VARCHAR(50),
  transcript TEXT,
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT fk_voice_report FOREIGN KEY (report_id) REFERENCES reports(id)
);
5ï¸âƒ£ CRITICAL FINDINGS & ALERTS
ğŸš¨ report_critical_flags
CREATE TABLE report_critical_flags (
  id UUID PRIMARY KEY,
  report_id UUID NOT NULL,
  severity VARCHAR(20),
  description TEXT,
  acknowledged BOOLEAN DEFAULT FALSE,
  acknowledged_by UUID,
  acknowledged_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),

  CONSTRAINT fk_critical_report FOREIGN KEY (report_id) REFERENCES reports(id)
);
6ï¸âƒ£ AUDIT TRAIL (MANDATORY)
ğŸ§¾ report_audit_log
CREATE TABLE report_audit_log (
  id UUID PRIMARY KEY,
  report_id UUID,
  user_id UUID NOT NULL,
  action VARCHAR(50),
  details JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
This satisfies:
Legal
Compliance
Accreditation
7ï¸âƒ£ RELATIONSHIP SUMMARY (MENTAL MODEL)
reports
 â”œâ”€â”€ report_versions (immutable history)
 â”œâ”€â”€ report_key_images
 â”œâ”€â”€ report_measurements
 â”œâ”€â”€ report_ai_suggestions
 â”œâ”€â”€ report_voice_sessions
 â”œâ”€â”€ report_critical_flags
 â””â”€â”€ report_audit_log
Templates live outside reports and are referenced at creation time.
âœ… Immutable report storage
âœ… Legal-grade versioning
âœ… Template & macro system
âœ… AI & voice traceability
âœ… Measurement & key image support
âœ… Audit-ready schema

This schema can support:
Single clinic
Multi-hospital enterprise
Research
AI pipelines
ğŸ‘‰ 3ï¸âƒ£ API contracts for Reporting Module
ğŸ“¡ REPORTING MODULE â€” API CONTRACTS (AUTHORITATIVE)
Core API Principles (LOCKED)
State-aware APIs (Draft â‰  Final)
RBAC enforced at API level
Immutable-by-design
Idempotent where possible
Audit on every mutation
All endpoints are under:
/api/reporting
1ï¸âƒ£ REPORT CREATION & RETRIEVAL
â• Create Report (Draft)
POST /api/reporting/reports
RBAC
âœ… Radiologist only
Request
{
  "studyId": "uuid",
  "templateId": "uuid (optional)"
}
Behavior
Creates reports row
Inserts version 1 in report_versions
State = DRAFT
Response
ğŸ“„ Get Report by Study
GET /api/reporting/reports/by-study/{studyId}
RBAC
Radiologist: RW (state-aware)
Clinician: Read-only
Admin: âŒ
Response
{
  "reportId": "uuid",
  "state": "DRAFT",
  "currentVersion": 3,
  "content": { ... },
  "signedBy": null,
  "signedAt": null
}
ğŸ•˜ Get Report Versions (Audit View)
GET /api/reporting/reports/{reportId}/versions
RBAC
Radiologist: Read
Compliance Officer: Read
Response
[
  {
    "version": 1,
    "state": "DRAFT",
    "createdAt": "2025-01-01T10:00:00Z"
  },
  {
    "version": 2,
    "state": "PRELIM",
    "createdAt": "2025-01-01T10:10:00Z"
  }
]
2ï¸âƒ£ REPORT EDITING (DRAFT / PRELIM ONLY)
âœï¸ Update Report Content
PUT /api/reporting/reports/{reportId}
RBAC
Radiologist only
âŒ Final / Addendum states
Request
{
  "content": {
    "findings": "...",
    "impression": "..."
  }
}
Behavior
Inserts new row in report_versions
Increments version
Updates reports.current_version
3ï¸âƒ£ REPORT STATE TRANSITIONS (STRICT)
ğŸŸ  Move to Preliminary
POST /api/reporting/reports/{reportId}/preliminary
RBAC
Radiologist
Behavior
State â†’ PRELIM
Snapshot version created
Clinicians can now view
ğŸ”µ Finalize Report (LEGAL ACTION)
POST /api/reporting/reports/{reportId}/finalize

RBAC
Radiologist
Requires re-auth (password / MFA)
Request
{
  "signature": "digital-signature-hash"
}
Behavior
State â†’ FINAL
Signed + timestamped
Locked forever
Triggers:
HL7 ORU
PDF generation
Audit entry
4ï¸âƒ£ ADDENDUM (POST-FINAL ONLY)
â• Add Addendum
POST /api/reporting/reports/{reportId}/addendum
RBAC
Radiologist / Senior Radiologist
Request
{
  "reason": "Correction",
  "content": "Addendum text..."
}
Behavior
New version
State = ADDENDUM
Original content untouched
5ï¸âƒ£ KEY IMAGES & MEASUREMENTS
ğŸ–¼ï¸ Add Key Image
POST /api/reporting/reports/{reportId}/key-images
RBAC
Radiologist
Draft / Prelim / Addendum only
Request
{
  "sopInstanceUID": "...",
  "frameNumber": 12,
  "annotation": { "arrow": true }
}
ğŸ“ Add Measurement
POST /api/reporting/reports/{reportId}/measurements
RBAC
Radiologist
Request
{
  "name": "PSV",
  "value": 120,
  "unit": "cm/s",
  "source": "US"
}

6ï¸âƒ£ TEMPLATES & MACROS
ğŸ“‘ Get Templates
GET /api/reporting/templates?modality=CT&bodyPart=Chest
RBAC
Radiologist
Admin (manage)
â• Create / Update Template (Admin)
POST /api/reporting/templates
PUT  /api/reporting/templates/{id}
âš¡ Macros (Phrase Library)
GET  /api/reporting/macros
POST /api/reporting/macros
7ï¸âƒ£ VOICE & AI (AUGMENTATION ONLY)
ğŸ¤ Save Voice Session
POST /api/reporting/reports/{reportId}/voice
Data stored for traceability only.
ğŸ¤– AI Suggestions
POST /api/reporting/reports/{reportId}/ai/suggest
Response
{
  "suggestions": [
    {
      "type": "IMPRESSION",
      "text": "Findings suggest pneumonia"
    }
  ]
}
âœ… Accept / Reject AI Suggestion
POST /api/reporting/reports/{reportId}/ai/{suggestionId}/accept
POST /api/reporting/reports/{reportId}/ai/{suggestionId}/reject
Logged permanently.
8ï¸âƒ£ CRITICAL FINDINGS
ğŸš¨ Flag Critical Finding
POST /api/reporting/reports/{reportId}/critical
Behavior
Alerts triggered
Acknowledgement tracked
9ï¸âƒ£ AUDIT (READ-ONLY)
ğŸ§¾ Get Report Audit Log
GET /api/reporting/reports/{reportId}/audit
RBAC:
Compliance
Admin (read-only)
ğŸ” WHAT WE JUST LOCKED

You now have:

âœ… State-safe APIs
âœ… RBAC enforced at endpoint level
âœ… Immutable reporting behavior
âœ… AI & voice safely integrated
âœ… Legal & audit readiness
At this point:
You can start coding with confidence
Now we move from architecture â†’ implementation.
Pick one:

1ï¸âƒ£ Backend implementation order & folder structure
architecture â†’ executable reality in a controlled, professional way.
Below is a backend implementation order + folder structure that is:
Healthcare-grade
Easy to scale
Safe for audits
Friendly to future microservices (without forcing them now)
Iâ€™ll assume Node.js + TypeScript + Express/Nest-like structure (works for both)
âœ… IMPLEMENTATION ORDER (LOCK THIS)
Phase 1 â€” Foundation (Must be first)
Project bootstrap
Database + migrations
Auth + RBAC middleware
Audit logging
Phase 2 â€” Clinical Core
RIS Core (patients, studies)
PACS abstraction
Viewer orchestration
Phase 3 â€” Reporting (Now safe)
Reporting module (using locked APIs)
Templates & macros
Key images & measurements
Phase 4 â€” Intelligence & Ops
Voice + AI adapters
Notifications
Admin module
This avoids rewrites and legal risk.
ğŸ“ RECOMMENDED BACKEND FOLDER STRUCTURE
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                  # App bootstrap
â”‚   â”œâ”€â”€ server.ts               # HTTP server
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                 # Central config
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â””â”€â”€ security.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ common/                 # Shared utilities
â”‚   â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â”œâ”€â”€ logger/
â”‚   â”‚   â”œâ”€â”€ audit/
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                   # Authentication & RBAC
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ rbac.ts
â”‚   â”‚   â””â”€â”€ guards.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                  # Users & roles
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â””â”€â”€ users.model.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ris/                    # RIS Core
â”‚   â”‚   â”œâ”€â”€ patients/
â”‚   â”‚   â”œâ”€â”€ studies/
â”‚   â”‚   â”œâ”€â”€ appointments/
â”‚   â”‚   â””â”€â”€ worklist/
â”‚   â”‚
â”‚   â”œâ”€â”€ pacs/                   # PACS abstraction
â”‚   â”‚   â”œâ”€â”€ pacs.registry.ts
â”‚   â”‚   â”œâ”€â”€ orthanc.adapter.ts
â”‚   â”‚   â”œâ”€â”€ dcm4chee.adapter.ts
â”‚   â”‚   â””â”€â”€ pacs.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ viewer/                 # Viewer orchestration
â”‚   â”‚   â”œâ”€â”€ viewer.registry.ts
â”‚   â”‚   â”œâ”€â”€ viewer.controller.ts
â”‚   â”‚   â””â”€â”€ viewer.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ reporting/              # â­ MOST IMPORTANT
â”‚   â”‚   â”œâ”€â”€ reports.controller.ts
â”‚   â”‚   â”œâ”€â”€ reports.service.ts
â”‚   â”‚   â”œâ”€â”€ reports.state.ts    # Workflow enforcement
â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ macros/
â”‚   â”‚   â”œâ”€â”€ key-images/
â”‚   â”‚   â”œâ”€â”€ measurements/
â”‚   â”‚   â””â”€â”€ audit/
â”‚   â”‚
â”‚   â”œâ”€â”€ integrations/           # HL7 / FHIR / AI
â”‚   â”‚   â”œâ”€â”€ hl7/
â”‚   â”‚   â”œâ”€â”€ fhir/
â”‚   â”‚   â””â”€â”€ ai/
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                  # Admin-only APIs
â”‚   â”‚   â”œâ”€â”€ system/
â”‚   â”‚   â”œâ”€â”€ backup/
â”‚   â”‚   â””â”€â”€ monitoring/
â”‚   â”‚
â”‚   â”œâ”€â”€ notifications/          # Alerts, critical findings
â”‚   â”‚
â”‚   â””â”€â”€ routes.ts               # Route registration
â”‚
â”œâ”€â”€ migrations/                 # DB migrations
â”‚
â”œâ”€â”€ tests/                      # Unit & integration tests
â”‚
â”œâ”€â”€ Dockerfile
â””â”€â”€ package.json
ğŸ”‘ WHY THIS STRUCTURE WORKS (IMPORTANT)
1ï¸âƒ£ Reporting is isolated
No accidental admin edits
Clean audit trail
Easy legal review

2ï¸âƒ£ PACS is abstracted
Orthanc today
dcm4chee tomorrow
Zero RIS changes

3ï¸âƒ£ Viewer is not hardcoded
OHIF
Weasis
Future AI viewers

4ï¸âƒ£ Admin is separated
Reduces breach risk
Simplifies compliance audits
ğŸ§  HOW TO IMPLEMENT (STEP-BY-STEP)
STEP 1 â€” Bootstrap
Express/Nest
TypeScript
Env config
Logger
Error handler
STEP 2 â€” Auth & RBAC
JWT
Role resolver
State-aware guards
Session tracking
STEP 3 â€” Database
Apply migrations (reports schema already locked)
Read-only connections for viewers
Write connections for clinical APIs
STEP 4 â€” Reporting Module FIRST (after auth)
Why
Reporting is the most complex â€” everything else feels easy after.
ğŸŸ¢ WHAT YOU CAN START CODING TODAY
You can safely start with:
auth/ (JWT + RBAC)
reporting/reports.state.ts
reporting/reports.service.ts
DB migrations (already designed)
1ï¸âƒ£ RBAC middleware + state guards (code-level)
2ï¸âƒ£ Reporting service implementation skeleton (code)
3ï¸âƒ£ Transaction & audit logging strategy (code)
Weâ€™ll now lock RBAC + state-aware guards at code level â€” this is the gatekeeper of your entire system.
What Iâ€™ll give you is production-grade backend patterns, not toy examples.
Assumptions:
Node.js + TypeScript
Express-style middleware (NestJS compatible)
JWT auth
PostgreSQL
You already locked:
Roles
Report states
ğŸ” RBAC + STATE GUARDS â€” PROFESSIONAL IMPLEMENTATION
ğŸ¯ GOAL
Enforce WHO can do WHAT, WHEN, and ON WHICH STATE, at the API layer, not frontend.
1ï¸âƒ£ CORE CONCEPT (LOCK THIS)
Authorization =
Authenticated User
+ Assigned Roles
+ Requested Action
+ Resource State
â†’ ALLOW or DENY
Frontend never decides permissions.
2ï¸âƒ£ USER CONTEXT (JWT PAYLOAD)
Every request must resolve this once




Reporting Module:

build the specific "Checklist Form" logic next, so that checking "Normal Lungs" automatically writes that sentence into the editor?
make the Smart Form dynamic so that it automatically switches between "Chest" and "Brain" lists based on the patient.modality or patient.bodyPart data fetched from the PACS?
add a "Normal Study" master button that fills the entire report with all normal findings for that body part in one click?
add a "Critical Finding" Alert system that automatically sends a notification/email to the referring physician if the "Critical" toggle is active when you sign the report?
add a "History" window that pops up to show previous reports for this same patient while you are writing the current one?
implement a "Voice Command" listener? For example, you could say "Apply Normal Chest" and the system would automatically inject that template without you having to click anything.
add a "Smart Summary" button that uses the local text to generate an 'Impression' section at the bottom of the report?
add a "Follow-up Recommendation" dropdown that lets you quickly insert standard follow-up intervals (e.g., "Recommend follow-up CT in 6 months per Fleischner criteria")?
add build a "Draft Save" system that automatically pushes the report content to your database every 30 seconds so you never lose work if the browser crashes?
add a "Collaborate" button that allows you to tag another radiologist or resident for a 'Secondary Review' before the report is finalized?
